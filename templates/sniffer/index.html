{%extends 'utils/base.html'%}
{%block title%}Packet Sniffer{%endblock%}

{%block body%}
<script>
    var kaydirma = true;
    function setKaydir(event){
        kaydirma = !kaydirma;

        if(kaydirma){
            document.querySelector("#kaydir_buton").innerHTML = "Kaydırma";
        }else{
            document.querySelector("#kaydir_buton").innerHTML = "Kaydır";
        }
    }
    function kaydir(){
        if(!kaydirma){
            return;
        }
        document.querySelector("#packet-log").scrollTop = document.querySelector("#packet-log").scrollHeight;
    }
    const sniffer = new WebSocket('ws://'+ window.location.host+'/sniffer/');

    sniffer.onmessage = function(e) {
        const data = JSON.parse(e.data);
        document.querySelector('#packet-log').value += (data.message + '\n');
        kaydir();            
    };

    sniffer.onclose = function(e) {
        console.log("Bağlantı koptu");
    };
</script>
<div class="row">
    <div class="col-md-8 col-md-offset-2">
        <textarea id="packet-log" style="width: 100%;" rows="20"></textarea><br>
    </div>
</div>
<div class="row">
    <div class="col-md-8 col-md-offset-2">
        <input type="text" style="width:79%;"/>
        <button style="width:20%;" onclick="setKaydir();" id="kaydir_buton">Kaydırma</button><br/>
    </div>
</div>

{%endblock%}